# This step runs the build, checks the version of the package and if it's a dev version uploads it to ahlpypi.
. ./build/bin/activate
cd %(project_name)s
python setup.py build
if ( [[ "$AHL_PYTHON_VERSIONS" == *"$PYTHON"* ]] ); then
  [ ! -z "`grep '^Version:' %(egg_name)s.egg-info/PKG-INFO  | cut -d' ' -f2 | sed s/[\.0-9]//g`" ] && python setup.py bdist_egg register upload
else
  echo "Skipping egg upload for Python: $PYTHON"
fi
# Only upload documentation if running in Prod Jenkins and for the
# current _PRIMARY_ PYTHON version
if [[ $JENKINS_URL != *dev* ]] && [[ $AHL_PYTHON_VERSIONS == $PYTHON* ]]; then
  python setup.py upload_docs
else
  echo "Skipping documentation upload, since running Python version \"$PYTHON\" on \"$JENKINS_URL\""
fi
